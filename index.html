<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="./time.png" type="image/x-icon" />
        <title>时间选择器</title>
        <style>
            * {
                margin: 0;
                padding: 0;
            }

            /* 隐藏滚动条 */
            ::-webkit-scrollbar {
                display: none;
            }

            .time_main {
                width: 100%;
                height: 100%;
                background-color: #fff;
            }

            .case {
                padding: 16px;
            }

            .choose_btn {
                display: inline-block;
                padding: 0 16px;
                height: 40px;
                margin: 0 auto;
                line-height: 40px;
                text-align: center;
                background-color: #007bff;
                color: #fff;
                border-radius: 10px;
                font-weight: 400;
            }

            .cs_time {
                padding: 16px;
                background-color: #febf32;
                border-radius: 0 20px 0 20px;
                color: #fff;
                margin-bottom: 16px;
            }

            .mark,
            .now_time {
                font-weight: bold;
                margin-left: 16px;
            }

            .mask_layer {
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 998;
                display: none;
                transition: all 0.3s ease-in-out;
            }

            .time_box1,
            .time_box2 {
                display: none;
                width: 80%;
                border-radius: 10px;
                background-color: #fff;
                z-index: 999;
                /* 屏幕居中 */
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .time_box1_btn {
                width: 100%;
                display: flex;
                justify-content: space-between;
                border-top: 1px solid rgba(179, 179, 179, 0.1);
            }

            .Sure,
            .Cancel {
                width: 50%;
                height: 48px;
                line-height: 48px;
                font-size: 16px;
                text-align: center;
                box-sizing: border-box;
            }

            .Sure {
                color: blue;
            }

            .line {
                width: 1px;
                height: auto;
                background-color: rgba(179, 179, 179, 0.1);
            }

            .time_box1_main,
            .time_box2_main {
                width: 100%;
                display: flex;
                padding: 12px 0;
            }

            /* 时分样式 */
            .hour_box,
            .minute_box {
                width: 50%;
                text-align: center;
                height: 150px;
                overflow: hidden;
                overflow-y: auto;
            }
            /* 时分样式 */

            /* 年月日样式 */
            .year_box,
            .moon_box,
            .day_box {
                width: 33%;
                text-align: center;
                height: 150px;
                overflow: hidden;
                overflow-y: auto;
            }
            /* 年月日样式 */

            .item,
            .item {
                font-size: 14px;
                line-height: 30px;
            }

            .item:first-child,
            .item:first-child {
                margin-top: 60px;
            }

            .item:last-child,
            .item:last-child {
                margin-bottom: 60px;
            }

            .select_line {
                position: absolute;
                top: 71px;
                height: 28px;
                width: 100%;
                margin: 0;
                z-index: -1;
                border: 1px solid rgba(179, 179, 179, 0.2);
                border-left: none;
                border-right: none;
            }
        </style>
    </head>

    <body>
        <div class="time_main">
            <!-- 案例 -->
            <div class="case">
                <div class="cs_time" style="background-color: #8675f1">
                    当前时间是:
                    <span class="now_time">--</span>
                </div>
                <div class="cs_time">
                    当前选择的时间是:
                    <span class="mark">--</span>
                </div>
                <!-- 时分选择器 -->
                <div class="choose_btn" data-choose="1">时分选择器</div>
                <!-- 年月日选择器 -->
                <div class="choose_btn" data-choose="2">年月日选择器</div>
            </div>
            <!-- 遮罩层 -->
            <div class="mask_layer"></div>
            <!-- 时间选择器 -->
            <div class="time_box1 dom_hide">
                <div class="time_box1_main">
                    <!-- 时钟 -->
                    <div class="hour_box" data-time="hour"></div>
                    <!-- 分钟 -->
                    <div class="minute_box" data-time="minute"></div>
                </div>
                <!-- 选择线 -->
                <p class="select_line"></p>
                <!-- 按钮 -->
                <div class="time_box1_btn">
                    <div class="Cancel">取消</div>
                    <div class="line"></div>
                    <div class="Sure">确定</div>
                </div>
            </div>
            <!-- 年月日选择器 -->
            <div class="time_box2 dom_hide">
                <div class="time_box2_main">
                    <!-- 年 -->
                    <div class="year_box" data-time="year"></div>
                    <!-- 月 -->
                    <div class="moon_box" data-time="moon"></div>
                    <!-- 日 -->
                    <div class="day_box" data-time="day"></div>
                </div>
                <!-- 选择线 -->
                <p class="select_line"></p>
                <!-- 按钮 -->
                <div class="time_box1_btn">
                    <div class="Cancel">取消</div>
                    <div class="line"></div>
                    <div class="Sure">确定</div>
                </div>
            </div>
        </div>
    </body>
    <script>
        /*
          ***************
            作者：谢佳毅
          ***************
        */

        // 判断是否为手机浏览器
        var isMobile = {
            Android: function () {
                return navigator.userAgent.match(/Android/i);
            },
            BlackBerry: function () {
                return navigator.userAgent.match(/BlackBerry/i);
            },
            iOS: function () {
                return navigator.userAgent.match(/iPhone|iPad|iPod/i);
            },
            Opera: function () {
                return navigator.userAgent.match(/Opera Mini/i);
            },
            Windows: function () {
                return navigator.userAgent.match(/IEMobile/i);
            },
            any: function () {
                return (
                    isMobile.Android() ||
                    isMobile.BlackBerry() ||
                    isMobile.iOS() ||
                    isMobile.Opera() ||
                    isMobile.Windows()
                );
            },
        };

        console.log(isMobile.any());

        // 获取当前时间
        function getNowTime() {
            var now_time = new Date();
            var now_year = now_time.getFullYear();
            var now_month = ('0' + (now_time.getMonth() + 1)).slice(-2);
            var now_day = ('0' + now_time.getDate()).slice(-2);
            var now_hour = ('0' + now_time.getHours()).slice(-2);
            var now_minute = ('0' + now_time.getMinutes()).slice(-2);
            var now_second = ('0' + now_time.getSeconds()).slice(-2);
            var now_time_str =
                now_year + '-' + now_month + '-' + now_day + ' ' + now_hour + ':' + now_minute + ':' + now_second;
            document.querySelector('.now_time').innerHTML = now_time_str;
        }
        getNowTime();
        setInterval(getNowTime, 1000);

        // *****时分选择器*****
        function DomRender() {
            // 小时渲染
            var hour_box = document.querySelector('.hour_box');
            var hour_box_html = '';
            for (let i = 0; i < 24; i++) {
                hour_box_html += '<div class="item">' + ('0' + i).slice(-2) + '</div>';
            }
            hour_box.innerHTML = hour_box_html;
            // 分钟渲染
            var minute_box = document.querySelector('.minute_box');
            var minute_box_html = '';
            for (let i = 0; i < 60; i++) {
                minute_box_html += '<div class="item">' + ('0' + i).slice(-2) + '</div>';
            }
            minute_box.innerHTML = minute_box_html;
            // 年份渲染
            var year_box = document.querySelector('.year_box');
            var year_box_html = '';
            for (let i = 1970; i <= 2099; i++) {
                year_box_html += '<div class="item">' + i + '</div>';
            }
            year_box.innerHTML = year_box_html;
        }
        DomRender();

        // 监听滚动条滚动
        var scrollTopStart = 0;
        var hour_box = document.querySelector('.hour_box');
        var minute_box = document.querySelector('.minute_box');
        var year_box = document.querySelector('.year_box');
        var item_scrollHeight = 30;
        // 对比时间的值
        var start = 0;
        var end = 0;
        var timer = null;

        // 判断滚动条走向
        function DomScroll(Dom) {
            Dom.addEventListener('scroll', function (e) {
                var e_t_scrollTop = e.target.scrollTop || e.target.pageYOffset;
                if (e_t_scrollTop > scrollTopStart) {
                    // 向下滚动
                    scrollTopStart = e_t_scrollTop;
                    if (e_t_scrollTop % item_scrollHeight != 0) {
                        e.target.scrollTop++;
                    }
                } else {
                    // 向上滚动
                    scrollTopStart = e_t_scrollTop;
                    if (e_t_scrollTop % item_scrollHeight != 0) {
                        e.target.scrollTop--;
                    }
                }
                // 判断滚动条是否停止滚动
                clearTimeout(timer); // 每次滚动前 清除一次
                start = e_t_scrollTop;
                timer = setTimeout(function () {
                    end = e_t_scrollTop;
                    if (end == start) {
                        console.log('停止滚动了');
                    }
                }, 500);
            });
        }
        DomScroll(hour_box);
        DomScroll(minute_box);
        DomScroll(year_box);

        // 点击确定获取时间
        var hour_txt = '00';
        var minute_txt = '00';
        var sure = document.querySelectorAll('.Sure');
        var choose = '1';
        for (let i = 0; i < sure.length; i++) {
            sure[i].addEventListener('click', function (e) {
                if (choose == 1) {
                    hour_minute();
                }
            });
        }
        // 时分确定按钮执行的函数体
        function hour_minute() {
            var hour_box_scrollTop = document.querySelector('.hour_box').scrollTop;
            var minute_box_scrollTop = document.querySelector('.minute_box').scrollTop;

            // 根据滚动条的位置获取时间
            if (
                (hour_box_scrollTop / item_scrollHeight) % 1 == 0 &&
                (minute_box_scrollTop / item_scrollHeight) % 1 == 0
            ) {
                hour_txt =
                    document.querySelector('.hour_box').childNodes[hour_box_scrollTop / item_scrollHeight].innerHTML;
                minute_txt =
                    document.querySelector('.minute_box').childNodes[minute_box_scrollTop / item_scrollHeight]
                        .innerHTML;
                document.querySelector('.mark').innerHTML = hour_txt + ':' + minute_txt;
                document.querySelector('.mask_layer').style.display = 'none';
                document.querySelector('.dom_hide').style.display = 'none';
            }
        }

        // 所有点击取消关闭时间选择器
        var cancel = document.querySelectorAll('.Cancel');
        for (let i = 0; i < cancel.length; i++) {
            cancel[i].addEventListener('click', function (e) {
                document.querySelector('.mask_layer').style.display = 'none';
                e.target.parentNode.parentNode.style.display = 'none';
            });
        }
        // *****时分选择器*****

        // 按钮点击事件
        var choose_btn = document.querySelectorAll('.choose_btn');
        for (let i = 0; i < choose_btn.length; i++) {
            choose_btn[i].addEventListener('click', function (e) {
                choose = e.target.dataset.choose;
                document.querySelector('.mask_layer').style.display = 'block';
                document.querySelector('.time_box' + e.target.dataset.choose).style.display = 'block';
                item_scrollHeight = Math.round(
                    document.querySelector('.time_box' + e.target.dataset.choose).querySelector('.item').clientHeight
                );
            });
        }
    </script>
</html>
